# Junkyard Tracker - Project Plan

> This project plan outlines the development roadmap for the Junkyard Tracker application, following an Epic -> Story -> Task hierarchy. It is based on the technical design and implementation guide.

## References & Callouts

- **Design Documents:** [SUMMARY.md](./SUMMARY.md), [TECHNICAL_DESIGN.md](./TECHNICAL_DESIGN.md), [IMPLEMENTATION_GUIDE.md](./IMPLEMENTATION_GUIDE.md)
- **Engineering Principles:** SOLID design, DRY, modularity, and maintainability.
- **Testing Philosophy:** A comprehensive, multi-layered testing strategy (Unit, Integration, E2E) is integral to every story.

---

## EPIC 1: Core Application Setup & Foundation

> **Goal:** Initialize the project, configure the development environment, and establish the foundational types and validation schemas that will drive the entire application.

### Story 1.1: Project Initialization

- **Description:** Set up the Next.js project with all required dependencies and configurations for TypeScript, Tailwind CSS, and ESLint.
- **Tasks:**
  - [ ] Initialize Next.js project using `create-next-app`.
  - [ ] Install production dependencies: `react-hook-form`, `@hookform/resolvers`, `zod`, `uuid`, `clsx`, `tailwind-merge`.
  - [ ] Install development dependencies: `vitest`, `@vitest/ui`, `@testing-library/react`, `playwright`, `@types/uuid`, etc.
  - [ ] Configure `tsconfig.json` with strict settings (`strict: true`, `noUncheckedIndexedAccess`).
  - [ ] Configure `tailwind.config.ts`.
  - [ ] Configure `eslint.config.mjs` with rules for exhaustive checks and unused variables.

### Story 1.2: Domain Modeling (Types)

- **Description:** Define all core TypeScript types for the application domain in a centralized `types/index.ts` file.
- **Tasks:**
  - [ ] Create `src/types/index.ts`.
  - [ ] Define and export literal types for enums (`VEHICLE_TYPES`, `ENGINE_STATUSES`, etc.).
  - [ ] Define and export the `Registration` discriminated union (`registered` | `failed`).
  - [ ] Define `VehicleBase` interface.
  - [ ] Define and export vehicle-specific interfaces (`Sedan`, `Coupe`, `MiniVan`, `Motorcycle`).
  - [ ] Define and export the main `Vehicle` discriminated union.
  - [ ] Define and export the generic `Result<T, E>` type for error handling.
  - [ ] Define and export state management types (`VehicleState`, `VehicleFilters`, etc.).

### Story 1.3: Validation Schema Definition

- **Description:** Create a comprehensive set of Zod schemas for validating form inputs and persisted data structures.
- **Tasks:**
  - [ ] Create `src/validations/schemas.ts`.
  - [ ] Implement primitive, vehicle-specific, registration, form input, and persisted data schemas.
  - [ ] Implement the top-level `StorageSchemaV1` for versioning data in localStorage.

### Story 1.4: Schema & Validation Unit Tests

- **Description:** Write unit tests for all Zod schemas to ensure validation logic is correct.
- **Tasks:**
  - [ ] Create `src/validations/schemas.test.ts`.
  - [ ] Write tests for `NicknameSchema` and `MileageSchema` with edge cases.
  - [ ] Write tests for the `VehicleFormInputSchema` discriminated union.
  - [ ] Write tests for the `MiniVanPersistedSchema` `superRefine` logic.

### Story 1.5: Base Testing Framework Setup

- **Description:** Configure the testing frameworks (Vitest and Playwright) and create initial setup files.
- **Tasks:**
  - [ ] Create and configure `vitest.config.ts`.
  - [ ] Create `tests/setup.ts` to mock `localStorage` and `crypto.randomUUID`.
  - [ ] Create and configure `playwright.config.ts`.
  - [ ] Run `npx playwright install` to install browser dependencies.

---

## EPIC 2: Vehicle Data Persistence & Services

> **Goal:** Develop the business logic and data handling layers, and validate them with unit and integration tests.

### Story 2.1: LocalStorage Repository & Unit Tests

- **Description:** Create and test a repository to handle the serialization, saving, and loading of vehicle data.
- **Tasks:**
  - [ ] Create `src/lib/storage.ts` with `save`, `load`, and `clear` functions.
  - [ ] Write unit tests for all repository functions in `src/lib/storage.test.ts`, covering success and error cases.

### Story 2.2: Registration Service & Unit Tests

- **Description:** Implement and test the deterministic logic for vehicle registration.
- **Tasks:**
  - [ ] Create `src/lib/registration-service.ts` with the `attemptRegistration` function and dev toggle.
  - [ ] Write comprehensive unit tests in `src/lib/registration-service.test.ts` for all success and failure rules.

### Story 2.3: Vehicle Service & Unit Tests

- **Description:** Create and test the main service layer for orchestrating vehicle CRUD operations.
- **Tasks:**
  - [ ] Create `src/lib/vehicle-service.ts` with `createVehicle` and `updateVehicle` functions.
  - [ ] Create `src/lib/defaults.ts` for default value logic.
  - [ ] Write unit tests for the vehicle service in `src/lib/vehicle-service.test.ts`.

### Story 2.4: Service Layer Integration Tests

- **Description:** Create integration tests to verify that all services and the repository work together correctly.
- **Tasks:**
  - [ ] Create `tests/integration/registration-flow.spec.ts` to test registration variations through the service layer.
  - [ ] Create `tests/integration/vehicle-crud.spec.ts`.
  - [ ] Write tests for the full CRUD flow, ensuring data integrity from service call to storage.
  - [ ] Write tests for business rules like nickname uniqueness and storage corruption recovery.

---

## EPIC 3: State Management & UI Hooks

> **Goal:** Build and test the client-side state management infrastructure.

### Story 3.1: Vehicle State Reducer & Context

- **Description:** Create a `useReducer` hook and React Context to manage and provide vehicle state.
- **Tasks:**
  - [ ] Create `src/hooks/use-vehicles.tsx`.
  - [ ] Define the `VehicleAction` union and the `vehicleReducer` function.
  - [ ] Create the `VehicleProvider` component, including effects for data hydration and persistence.
  - [ ] Implement memoized selectors for derived data.

### Story 3.2: State Management Unit Tests

- **Description:** Write unit tests for the state reducer and selectors.
- **Tasks:**
  - [ ] Create `src/hooks/use-vehicles.test.tsx`.
  - [ ] Write tests for all reducer actions to ensure correct state transitions.
  - [ ] Write tests for selectors to verify filtering and sorting logic.

### Story 3.3: UI Hooks

- **Description:** Develop custom hooks for UI interactions like notifications.
- **Tasks:**
  - [ ] Create `src/hooks/use-toast.tsx` and its associated `ToastProvider`.

---

## EPIC 4: Vehicle CRUD User Interface

> **Goal:** Build and test all React components and pages for vehicle management.

### Story 4.1: Core UI Components

- **Description:** Create the set of generic, reusable UI components.
- **Tasks:**
  - [ ] Create `Button.tsx`, `Input.tsx`, `Select.tsx`, `Badge.tsx`.
  - [ ] Create `Toast.tsx` and `ConfirmDialog.tsx`.
  - [ ] (Optional) Write basic rendering tests for complex UI components.

### Story 4.2: Vehicle Form & Component Tests

- **Description:** Build and test the vehicle form for creating and editing vehicles.
- **Design Reference:** [Vehicle Form.png](./designs/Vehicle%20Form.png)
- **Tasks:**
  - [ ] Create type-specific field components (`SedanFields.tsx`, etc.).
  - [ ] Create the main `VehicleForm.tsx` component.
  - [ ] Write component tests for `VehicleForm.tsx` to verify dynamic rendering and validation feedback.

### Story 4.3: Vehicle List View & Component Tests

- **Description:** Develop and test the main dashboard for displaying, filtering, and sorting vehicles.
- **Design Reference:** [Dashboard \_ Vehicle Listing.png](./designs/Dashboard%20_%20Vehicle%20Listing.png)
- **Tasks:**
  - [ ] Create the `VehicleTable.tsx` and `FiltersBar.tsx` components.
  - [ ] Write component tests for `VehicleTable.tsx` to verify data rendering.
  - [ ] Assemble the components into the dashboard page at `src/app/vehicles/page.tsx`.

### Story 4.4: Vehicle Details Page

- **Description:** Create the read-only view for displaying the comprehensive details of a single vehicle.
- **Design Reference:** [Vehicle Details.png](./designs/Vehicle%20Details.png)
- **Tasks:**
  - [ ] Create the vehicle details page at `src/app/vehicles/[id]/page.tsx`.
  - [ ] Implement UI to display key specifications, condition, mileage, and registration history.
  - [ ] Add 'Edit' and 'Delete' buttons that navigate to the appropriate actions.

### Story 4.5: Registration Log Page

- **Description:** Create the page to display a log of all vehicle registration activities.
- **Design Reference:** [Registration Log.png](./designs/Registration%20Log.png)
- **Tasks:**
  - [ ] Create the registration log page at `src/app/registration-log/page.tsx` (or similar route).
  - [ ] Implement UI with filtering and search capabilities for the log.
  - [ ] Display registration status, timestamps, and error messages as per the design.

### Story 4.6: CRUD E2E Tests

- **Description:** Use Playwright to conduct E2E tests for the complete create, read, update, and delete user journeys.
- **Tasks:**
  - [ ] Create `tests/e2e/create-vehicle.spec.ts` to test the creation flow.
  - [ ] Create `tests/e2e/edit-vehicle.spec.ts` to test the editing flow.
  - [ ] Create `tests/e2e/delete-vehicle.spec.ts` to test the deletion flow.

### Story 4.7: Filtering & Sorting E2E Tests

- **Description:** Use Playwright to test the dashboard's interactive features.
- **Tasks:**
  - [ ] Create `tests/e2e/filters.spec.ts`.
  - [ ] Write tests to verify that search, filter, and sort controls correctly update the vehicle list.

---

## EPIC 5: Final Testing & QA

> **Goal:** Perform final cross-cutting tests, harden existing tests, and conduct exploratory testing to ensure overall application quality.

### Story 5.1: Test Hardening & Refinement

- **Description:** Review and improve existing tests for reliability and coverage.
- **Tasks:**
  - [ ] Review all E2E tests and add assertions for toast notifications.
  - [ ] Analyze test coverage reports and add unit tests for any missed critical logic.
  - [ ] Refactor test code for clarity and maintainability (e.g., creating test factories or page object models).

### Story 5.2: Cross-Cutting & Exploratory Testing

- **Description:** Manually test for issues not easily covered by automated tests.
- **Tasks:**
  - [ ] Perform accessibility (a11y) checks for keyboard navigation, screen reader support, and color contrast.
  - [ ] Conduct responsive design testing across a range of device widths.
  - [ ] Perform exploratory testing on the live application to find edge cases and usability issues.

---

## EPIC 6: UI Polish & Finalization

> **Goal:** Refine the user experience, add final touches, and ensure the application is visually appealing and easy to use.

### Story 6.1: Responsive Design & State Refinements

- **Description:** Ensure the application is fully responsive and provides clear feedback on its state.
- **Tasks:**
  - [ ] Add loading states (e.g., spinners) for data hydration and form submissions.
  - [ ] Implement a graceful error recovery UI for data hydration failures.
  - [ ] Finalize the responsive layouts for the table, filters, and forms.

### Story 6.2: Notifications & User Feedback

- **Description:** Implement clear user feedback for all primary actions.
- **Tasks:**
  - [ ] Integrate the `useToast` hook to show success/error notifications for all CRUD actions.
  - [ ] Ensure form-level error banners are shown for business rule violations (e.g., nickname taken).
  - [ ] Implement and connect the confirmation dialog for the delete action.
