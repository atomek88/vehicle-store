# Junkyard Tracker - Project Plan

> This project plan outlines the development roadmap for the Junkyard Tracker application, following an Epic -> Story -> Task hierarchy. It is based on the technical design and implementation guide.

## References & Callouts

- **Design Documents:** [SUMMARY.md](./SUMMARY.md), [TECHNICAL_DESIGN.md](./TECHNICAL_DESIGN.md), [IMPLEMENTATION_GUIDE.md](./IMPLEMENTATION_GUIDE.md)
- **Engineering Principles:** SOLID design, DRY, modularity, and maintainability.
- **Testing Philosophy:** A comprehensive, multi-layered testing strategy (Unit, Integration, E2E) is integral to every story.

---

## EPIC 1: Core Application Setup & Foundation ✅ COMPLETED

> **Goal:** Initialize the project, configure the development environment, and establish the foundational types and validation schemas that will drive the entire application.
>
> **Status:** All stories completed. 32 unit tests created with comprehensive coverage of all schemas.

### Story 1.1: Project Initialization ✅

- **Description:** Set up the Next.js project with all required dependencies and configurations for TypeScript, Tailwind CSS, and ESLint.
- **Tasks:**
  - [x] Initialize Next.js project using `create-next-app`.
  - [x] Install production dependencies: `react-hook-form`, `@hookform/resolvers`, `zod`, `uuid`, `clsx`, `tailwind-merge`.
  - [x] Install development dependencies: `vitest`, `@vitest/ui`, `@testing-library/react`, `playwright`, `@types/uuid`, `jsdom`.
  - [x] Configure `tsconfig.json` with strict settings (`strict: true`, `noUncheckedIndexedAccess`).
  - [x] Configure `tailwind.config.ts`.
  - [x] Configure `eslint.config.mjs` with rules for exhaustive checks and unused variables.

### Story 1.2: Domain Modeling (Types) ✅

- **Description:** Define all core TypeScript types for the application domain in a centralized `types/index.ts` file.
- **Tasks:**
  - [x] Create `src/types/index.ts`.
  - [x] Define and export literal types for enums (`VEHICLE_TYPES`, `ENGINE_STATUSES`, etc.).
  - [x] Define and export the `Registration` discriminated union (`registered` | `failed`).
  - [x] Define `VehicleBase` interface.
  - [x] Define and export vehicle-specific interfaces (`Sedan`, `Coupe`, `MiniVan`, `Motorcycle`).
  - [x] Define and export the main `Vehicle` discriminated union.
  - [x] Define and export the generic `Result<T, E>` type for error handling.
  - [x] Define and export state management types (`VehicleState`, `VehicleFilters`, etc.).

### Story 1.3: Validation Schema Definition ✅

- **Description:** Create a comprehensive set of Zod schemas for validating form inputs and persisted data structures.
- **Tasks:**
  - [x] Create `src/validations/schemas.ts`.
  - [x] Implement primitive, vehicle-specific, registration, form input, and persisted data schemas.
  - [x] Implement the top-level `StorageSchemaV1` for versioning data in localStorage.

### Story 1.4: Schema & Validation Unit Tests ✅

- **Description:** Write unit tests for all Zod schemas to ensure validation logic is correct.
- **Tasks:**
  - [x] Create `src/validations/schemas.test.ts`.
  - [x] Write tests for `NicknameSchema` and `MileageSchema` with edge cases.
  - [x] Write tests for the `VehicleFormInputSchema` discriminated union.
  - [x] Write tests for the `MiniVanPersistedSchema` `superRefine` logic.

### Story 1.5: Base Testing Framework Setup ✅

- **Description:** Configure the testing frameworks (Vitest and Playwright) and create initial setup files.
- **Tasks:**
  - [x] Create and configure `vitest.config.ts`.
  - [x] Create `tests/setup.ts` to mock `localStorage` and `crypto.randomUUID`.
  - [x] Create and configure `playwright.config.ts`.
  - [x] Run `npx playwright install` to install browser dependencies.

---

## EPIC 2: Vehicle Data Persistence & Services ✅

> **Goal:** Develop the business logic and data handling layers, and validate them with unit and integration tests.
>
> **Status:** All stories completed. 100+ unit and integration tests created covering all service layers, business rules, and data integrity.

### Story 2.1: LocalStorage Repository & Unit Tests ✅

- **Description:** Create and test a repository to handle the serialization, saving, and loading of vehicle data.
- **Tasks:**
  - [x] Create `src/lib/storage.ts` with `save`, `load`, and `clear` methods.
  - [x] Implement versioned storage schema using `StorageSchemaV1`.
  - [x] Create `src/lib/storage.test.ts` with tests for all repository methods.
  - [x] Write tests for error recovery (corrupted JSON, invalid schema).

### Story 2.2: Registration Service & Unit Tests ✅

- **Description:** Implement and test the business logic for vehicle registration based on type and mileage.
- **Tasks:**
  - [x] Create `src/lib/registration.ts` with `attemptRegistration` function.
  - [x] Implement business rules: sedans fail if mileage > 100,000; motorcycles fail if mileage > 50,000.
  - [x] Create `src/lib/registration.test.ts`.
  - [x] Write tests for all vehicle types and edge cases (at limit, over limit, etc.).

### Story 2.3: Vehicle Service & Unit Tests ✅

- **Description:** Build and test the main service layer for CRUD operations on vehicles.
- **Tasks:**
  - [x] Create `src/lib/defaults.ts` for default values (wheels, doors, engine status, etc.).
  - [x] Create `src/lib/vehicle-service.ts` with `createVehicle`, `updateVehicle`, and `deleteVehicle`.
  - [x] Implement nickname uniqueness validation (case-insensitive).
  - [x] Create `src/lib/vehicle-service.test.ts` and `src/lib/defaults.test.ts`.
  - [x] Write tests for CRUD operations, defaults application, and business rules.

### Story 2.4: Service Layer Integration Tests ✅

- **Description:** Create integration tests to verify that all services and the repository work together correctly.
- **Tasks:**
  - [x] Create `tests/integration/vehicle-crud.spec.ts`.
  - [x] Write tests for the full CRUD flow, ensuring data integrity from service call to storage.
  - [x] Write tests for business rules like nickname uniqueness and storage corruption recovery.
  - [x] Write tests for data integrity (field preservation, registration immutability).

---

## EPIC 3: State Management & UI Hooks ✅ COMPLETED

> **Goal:** Build and test the client-side state management infrastructure.
>
> **Status:** All stories completed. State management with reducer, context, filtering, sorting, and persistence implemented with 30+ comprehensive tests.

### Story 3.1: Vehicle State Reducer & Context ✅

- **Description:** Create a `useReducer` hook and React Context to manage and provide vehicle state.
- **Tasks:**
  - [x] Create `src/hooks/use-vehicles.tsx`.
  - [x] Define the `VehicleAction` union and the `vehicleReducer` function.
  - [x] Create the `VehicleProvider` component, including effects for data hydration and persistence.
  - [x] Implement memoized selectors for derived data.

### Story 3.2: State Management Unit Tests ✅

- **Description:** Write unit tests for the state reducer and selectors.
- **Tasks:**
  - [x] Create `src/hooks/use-vehicles.test.tsx`.
  - [x] Write tests for all reducer actions to ensure correct state transitions.
  - [x] Write tests for selectors to verify filtering and sorting logic.

### Story 3.3: UI Hooks ✅

- **Description:** Develop custom hooks for UI interactions like notifications.
- **Tasks:**
  - [x] Create `src/hooks/use-toast.tsx` and its associated `ToastProvider`.

---

## EPIC 4: Vehicle CRUD User Interface

> **Goal:** Build and test all React components and pages for vehicle management.

### Story 4.1: Core UI Components ✅

- **Description:** Create the set of generic, reusable UI components.
- **Tasks:**
  - [x] Create `Button.tsx`, `Input.tsx`, `Select.tsx`, `Badge.tsx`.
  - [x] Create `Toast.tsx` and `ConfirmDialog.tsx`.
  - [x] (Optional) Write basic rendering tests for complex UI components.

### Story 4.2: Vehicle Form & Component Tests ✅

- **Description:** Build and test the vehicle form for creating and editing vehicles.
- **Design Reference:** [Vehicle Form.png](./designs/Vehicle%20Form.png) _(Use for UI styling/layout reference only; implement fields per technical design)_
- **Tasks:**
  - [x] Create type-specific field components (`SedanFields.tsx`, etc.) per technical spec.
  - [x] Create the main `VehicleForm.tsx` component with fields: nickname, mileage, vehicle type selector, and type-specific fields (wheels, doors, etc.).
  - [x] Write component tests for `VehicleForm.tsx` to verify dynamic rendering and validation feedback.

### Story 4.3: Vehicle List View & Component Tests ✅

- **Description:** Develop and test the main dashboard for displaying, filtering, and sorting vehicles.
- **Design Reference:** [Dashboard \_ Vehicle Listing.png](./designs/Dashboard%20_%20Vehicle%20Listing.png) _(Use for UI styling/layout reference only; display data per technical design - ignore "Truck" type in mockup)_
- **Tasks:**
  - [x] Create the `VehicleTable.tsx` and `FiltersBar.tsx` components.
  - [x] Display vehicle columns: Type, Nickname, Mileage, Registration ID/Status, Engine Status, Actions.
  - [x] Write component tests for `VehicleTable.tsx` to verify data rendering.
  - [x] Assemble the components into the dashboard page at `src/app/vehicles/page.tsx`.

### Story 4.4: Vehicle Details Page ✅

- **Description:** Create the read-only view for displaying the comprehensive details of a single vehicle.
- **Design Reference:** [Vehicle Details.png](./designs/Vehicle%20Details.png) _(Use for UI styling/layout reference only; follow technical design for data fields)_
- **Tasks:**
  - [x] Create the vehicle details page at `src/app/vehicles/[id]/page.tsx`.
  - [x] Display vehicle fields per technical spec: type, nickname, mileage, wheels, doors (or type-specific fields), engine status, and registration status.
  - [x] Show registration as a single immutable value (success with ID or failed with error message).
  - [x] Add 'Edit' and 'Delete' buttons that navigate to the appropriate actions.

### Story 4.5: Registration Log Page ✅

- **Description:** Create a page to display all vehicles with a focus on their registration status. This is a filtered/specialized view of the vehicle list, not a separate data model.
- **Design Reference:** [Registration Log.png](./designs/Registration%20Log.png) _(Use for UI styling/layout reference only; data comes from existing Vehicle model)_
- **Tasks:**
  - [x] Create the registration log page at `src/app/registration-log/page.tsx`.
  - [x] Display vehicles with columns: Registration ID (or error), Vehicle (nickname + type), Status, Timestamp (createdAt).
  - [x] Implement filtering by registration status (Success/Failed/Pending if applicable).
  - [x] Add search functionality by vehicle nickname or registration ID.
  - [x] Reuse existing vehicle state/context - no new data model needed.

### Story 4.6: CRUD E2E Tests ✅

- **Description:** Use Playwright to conduct E2E tests for the complete create, read, update, and delete user journeys.
- **Tasks:**
  - [x] Create `tests/e2e/create-vehicle.spec.ts` to test the creation flow.
  - [x] Create `tests/e2e/edit-vehicle.spec.ts` to test the editing flow.
  - [x] Create `tests/e2e/delete-vehicle.spec.ts` to test the deletion flow.

### Story 4.7: Filtering & Sorting E2E Tests

- **Description:** Use Playwright to test the dashboard's interactive features.
- **Tasks:**
  - [ ] Create `tests/e2e/filters.spec.ts`.
  - [ ] Write tests to verify that search, filter, and sort controls correctly update the vehicle list.

---

## EPIC 5: Final Testing & QA

> **Goal:** Perform final cross-cutting tests, harden existing tests, and conduct exploratory testing to ensure overall application quality.

### Story 5.1: Test Hardening & Refinement

- **Description:** Review and improve existing tests for reliability and coverage.
- **Tasks:**
  - [ ] Review all E2E tests and add assertions for toast notifications.
  - [ ] Analyze test coverage reports and add unit tests for any missed critical logic.
  - [ ] Refactor test code for clarity and maintainability (e.g., creating test factories or page object models).

### Story 5.2: Cross-Cutting & Exploratory Testing

- **Description:** Manually test for issues not easily covered by automated tests.
- **Tasks:**
  - [ ] Perform accessibility (a11y) checks for keyboard navigation, screen reader support, and color contrast.
  - [ ] Conduct responsive design testing across a range of device widths.
  - [ ] Perform exploratory testing on the live application to find edge cases and usability issues.

---

## EPIC 6: UI Polish & Finalization

> **Goal:** Refine the user experience, add final touches, and ensure the application is visually appealing and easy to use.

### Story 6.1: Responsive Design & State Refinements

- **Description:** Ensure the application is fully responsive and provides clear feedback on its state.
- **Tasks:**
  - [ ] Add loading states (e.g., spinners) for data hydration and form submissions.
  - [ ] Implement a graceful error recovery UI for data hydration failures.
  - [ ] Finalize the responsive layouts for the table, filters, and forms.

### Story 6.2: Notifications & User Feedback

- **Description:** Implement clear user feedback for all primary actions.
- **Tasks:**
  - [ ] Integrate the `useToast` hook to show success/error notifications for all CRUD actions.
  - [ ] Ensure form-level error banners are shown for business rule violations (e.g., nickname taken).
  - [ ] Implement and connect the confirmation dialog for the delete action.
